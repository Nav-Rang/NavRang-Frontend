<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NavRang | Login</title>
    <link rel="icon" type="image/png" href="https://res.cloudinary.com/dm26lxw7u/image/upload/v1751883905/NavRang_zzk8rf.png">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="auth.css">
    <style>
        .auth-tabs { display: flex; border-bottom: 1px solid #ddd; margin-bottom: 1.5rem; }
        .tab-link { flex: 1; padding: 1rem; text-align: center; cursor: pointer; background: #f9f9f9; color: #777; font-weight: 600; border-bottom: 3px solid transparent; }
        .tab-link.active { color: var(--day9-purple); border-bottom-color: var(--day9-purple); background: white; }
        .form-container { display: none; }
        .form-container.active { display: block; }
        .otp-input-group { display: flex; gap: 10px; }
        .otp-input-group .form-input { text-align: center; }
    </style>
</head>
<body>
    <div class="auth-container">
        <div class="auth-left">
            <img height="150px" style="border-radius: 15px;" src="https://res.cloudinary.com/dm26lxw7u/image/upload/v1751883905/NavRang_zzk8rf.png" alt="NavRang Logo">
            <h1 class="sacred-logo">NavRang</h1>
            <p class="sacred-tagline">Your Divine Shopping Destination</p>
        </div>

        <div class="auth-right">
            <div class="auth-tabs">
                <div class="tab-link active" onclick="switchTab('password')">Use Password</div>
                <div class="tab-link" onclick="switchTab('otp')">Use OTP</div>
            </div>

            <div id="password-form" class="form-container active">
                <form class="auth-form" id="loginFormPassword">
                    <div class="form-header">
                        <h2 class="form-title">Welcome Back</h2>
                        <p class="form-subtitle">Login with your password</p>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="email-password">Email Address</label>
                        <input type="email" id="email-password" class="form-input" placeholder="Enter your email" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="password">Password</label>
                        <input type="password" id="password" class="form-input" placeholder="Enter your password" required>
                    </div>
                    <button type="submit" class="auth-button" id="loginButtonPassword">Login</button>
                </form>
            </div>

            <div id="otp-form" class="form-container">
                <form class="auth-form" id="loginFormOtp">
                    <div class="form-header">
                        <h2 class="form-title">OTP Login</h2>
                        <p class="form-subtitle">Get a one-time code to log in</p>
                    </div>
                    <div class="form-group" id="otp-email-group">
                        <label class="form-label" for="email-otp">Email Address</label>
                        <input type="email" id="email-otp" class="form-input" placeholder="Enter your email" required>
                        <button type="button" class="auth-button" id="sendOtpButton" style="margin-top: 1rem;">Send OTP</button>
                    </div>
                    <div class="form-group" id="otp-verify-group" style="display: none;">
                        <label class="form-label" for="otp">Enter OTP</label>
                        <input type="text" id="otp" class="form-input" placeholder="Enter 6-digit OTP" required>
                        <button type="submit" class="auth-button" id="verifyOtpButton" style="margin-top: 1rem;">Verify OTP & Login</button>
                    </div>
                </form>
            </div>
            
            <div class="form-footer">
                <p>Don't have an account? <a href="signup.html">Sign Up</a></p>
            </div>
        </div>
    </div>

    <script>
        const backendUrl = 'https://navrang-backend.onrender.com/api';

        function switchTab(tabName) {
            document.querySelectorAll('.tab-link').forEach(tab => tab.classList.remove('active'));
            document.querySelector(`.tab-link[onclick="switchTab('${tabName}')"]`).classList.add('active');
            
            document.querySelectorAll('.form-container').forEach(form => form.classList.remove('active'));
            document.getElementById(`${tabName}-form`).classList.add('active');
        }

        document.getElementById('loginFormPassword').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email-password').value;
            const password = document.getElementById('password').value;
            const button = document.getElementById('loginButtonPassword');
            
            setLoadingState(button, true, 'Logging In...');
            try {
                const response = await axios.post(`${backendUrl}/login`, { email, password });
                handleSuccessfulLogin(response.data.token, response.data.user);
            } catch (error) {
                const errorMessage = error.response?.data?.message || 'Login failed. Please check your credentials.';
                showNotification(errorMessage, 'error');
            } finally {
                setLoadingState(button, false, 'Login');
            }
        });

        document.getElementById('sendOtpButton').addEventListener('click', async () => {
            const email = document.getElementById('email-otp').value;
            if (!email) {
                showNotification('Please enter your email address.', 'error');
                return;
            }
            const button = document.getElementById('sendOtpButton');
            setLoadingState(button, true, 'Sending...');
            try {
                await axios.post(`${backendUrl}/sendOTP`, { email });
                showNotification('OTP sent to your email!', 'success');
                document.getElementById('otp-email-group').style.display = 'none';
                document.getElementById('otp-verify-group').style.display = 'block';
            } catch (error) {
                const errorMessage = error.response?.data?.message || 'Failed to send OTP.';
                showNotification(errorMessage, 'error');
            } finally {
                setLoadingState(button, false, 'Send OTP');
            }
        });

        document.getElementById('loginFormOtp').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email-otp').value;
            const otp = document.getElementById('otp').value;
            const button = document.getElementById('verifyOtpButton');

            setLoadingState(button, true, 'Verifying...');
            try {
                const response = await axios.post(`${backendUrl}/verifyOTP`, { email, otp });
                handleSuccessfulLogin(response.data.token, response.data.user);
            } catch (error) {
                const errorMessage = error.response?.data?.message || 'Invalid OTP. Please try again.';
                showNotification(errorMessage, 'error');
            } finally {
                setLoadingState(button, false, 'Verify OTP & Login');
            }
        });

        function handleSuccessfulLogin(token, user) {
            localStorage.setItem('authToken', token);
            localStorage.setItem('userLoggedIn', 'true');
            localStorage.setItem('userEmail', user.email);
            localStorage.setItem('userName', user.name);
            
            showNotification('Login successful! Welcome back. ðŸ•‰ï¸', 'success');
            setTimeout(() => { window.location.href = 'index.html'; }, 1500);
        }

        function setLoadingState(button, isLoading, loadingText) {
            button.disabled = isLoading;
            const originalText = button.getAttribute('data-original-text') || button.textContent;
            if (!isLoading && !button.getAttribute('data-original-text')) {
                button.setAttribute('data-original-text', originalText);
            }
            button.innerHTML = isLoading ? `<span class="spinner"></span> ${loadingText}` : originalText;
        }

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => { notification.classList.add('show'); }, 10);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 500);
            }, 3000);
        }
    </script>
</body>
</html>