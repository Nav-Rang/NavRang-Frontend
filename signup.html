<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NavRang | Sign Up</title>
    <link rel="icon" type="image/png" href="https://res.cloudinary.com/dm26lxw7u/image/upload/v1751883905/NavRang_zzk8rf.png">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="auth.css">
    <style>
        .auth-tabs { display: flex; border-bottom: 1px solid #ddd; margin-bottom: 1.5rem; }
        .tab-link { flex: 1; padding: 1rem; text-align: center; cursor: pointer; background: #f9f9f9; color: #777; font-weight: 600; border-bottom: 3px solid transparent; }
        .tab-link.active { color: var(--day9-purple); border-bottom-color: var(--day9-purple); background: white; }
        .form-container { display: none; }
        .form-container.active { display: block; }
        #password-rules { font-size: 0.8rem; color: #708090; margin-top: -1rem; margin-bottom: 1.5rem; padding-left: 1rem; }
        #password-rules li { list-style-type: 'âœ— '; padding-left: 0.5rem; transition: color 0.3s ease; }
        #password-rules li.valid { color: #28a745; list-style-type: 'âœ“ '; font-weight: 500; }
    </style>
</head>
<body>
    <div class="auth-container">
        <div class="auth-left">
            <img height="150px" style="border-radius: 15px;" src="https://res.cloudinary.com/dm26lxw7u/image/upload/v1751883905/NavRang_zzk8rf.png" alt="NavRang Logo">
            <h1 class="sacred-logo">NavRang</h1>
            <p class="sacred-tagline">Your Divine Shopping Destination</p>
        </div>

        <div class="auth-right">
             <div class="auth-tabs">
                <div class="tab-link active" onclick="switchTab('password')">Use Password</div>
                <div class="tab-link" onclick="switchTab('otp')">Use OTP</div>
            </div>

            <div id="password-form" class="form-container active">
                <form class="auth-form" id="signupFormPassword">
                    <div class="form-header">
                        <h2 class="form-title">Create Account</h2>
                        <p class="form-subtitle">Join with a secure password</p>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="name-password">Your Name</label>
                        <input type="text" id="name-password" class="form-input" placeholder="Enter your full name" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="email-password">Email Address</label>
                        <input type="email" id="email-password" class="form-input" placeholder="Enter your email" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="password">Password</label>
                        <input type="password" id="password" class="form-input" placeholder="Create a password" required>
                    </div>
                    
                    <ul id="password-rules">
                        <li id="rule-length">At least 8 characters long</li>
                        <li id="rule-capital">Contains a capital letter</li>
                        <li id="rule-number">Contains a number</li>
                        <li id="rule-special">Contains a special character (!@#$%^&*)</li>
                    </ul>

                    <button type="submit" class="auth-button" id="signupButtonPassword">Create Account</button>
                </form>
            </div>

            <div id="otp-form" class="form-container">
                 <form class="auth-form" id="signupFormOtp">
                    <div class="form-header">
                        <h2 class="form-title">OTP Signup</h2>
                        <p class="form-subtitle">Verify your email to create an account</p>
                    </div>
                    <div id="otp-details-group">
                        <div class="form-group">
                            <label class="form-label" for="name-otp">Your Name</label>
                            <input type="text" id="name-otp" class="form-input" placeholder="Enter your full name" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="email-otp">Email Address</label>
                            <input type="email" id="email-otp" class="form-input" placeholder="Enter your email" required>
                        </div>
                        <button type="button" class="auth-button" id="sendOtpButton">Send OTP</button>
                    </div>
                    <div class="form-group" id="otp-verify-group" style="display: none;">
                        <label class="form-label" for="otp">Enter OTP</label>
                        <input type="text" id="otp" class="form-input" placeholder="Enter 6-digit OTP" required>
                        <button type="submit" class="auth-button" id="verifyOtpButton" style="margin-top: 1rem;">Verify OTP & Create Account</button>
                    </div>
                </form>
            </div>

            <div class="form-footer">
                <p>Already have an account? <a href="login.html">Log In</a></p>
            </div>
        </div>
    </div>

    <script>
        const backendUrl = 'https://navrang-backend.onrender.com/api';

        function switchTab(tabName) {
            document.querySelectorAll('.tab-link').forEach(tab => tab.classList.remove('active'));
            document.querySelector(`.tab-link[onclick="switchTab('${tabName}')"]`).classList.add('active');
            
            document.querySelectorAll('.form-container').forEach(form => form.classList.remove('active'));
            document.getElementById(`${tabName}-form`).classList.add('active');
        }

        const passwordInput = document.getElementById('password');
        const rules = {
            length: document.getElementById('rule-length'),
            capital: document.getElementById('rule-capital'),
            number: document.getElementById('rule-number'),
            special: document.getElementById('rule-special'),
        };

        function validatePassword(password) {
            const hasCapital = /[A-Z]/.test(password);
            const hasNumber = /[0-9]/.test(password);
            const hasSpecial = /[!@#$%^&*]/.test(password);
            const hasLength = password.length >= 8;

            rules.length.classList.toggle('valid', hasLength);
            rules.capital.classList.toggle('valid', hasCapital);
            rules.number.classList.toggle('valid', hasNumber);
            rules.special.classList.toggle('valid', hasSpecial);

            return hasLength && hasCapital && hasNumber && hasSpecial;
        }

        passwordInput.addEventListener('input', () => {
            validatePassword(passwordInput.value);
        });

        document.getElementById('signupFormPassword').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email-password').value;
            const password = document.getElementById('password').value;
            const name = document.getElementById('name-password').value;
            const button = document.getElementById('signupButtonPassword');

            if (!validatePassword(password)) {
                showNotification('Password does not meet all requirements.', 'error');
                return;
            }

            setLoadingState(button, true, 'Creating Account...');
            try {
                const response = await axios.post(`${backendUrl}/signup`, { name, email, password });
                handleSuccessfulLogin(response.data.token, response.data.user);
            } catch (error) {
                const errorMessage = error.response?.data?.message || 'Signup failed.';
                showNotification(errorMessage, 'error');
            } finally {
                setLoadingState(button, false, 'Create Account');
            }
        });

        document.getElementById('sendOtpButton').addEventListener('click', async () => {
            const email = document.getElementById('email-otp').value;
            const name = document.getElementById('name-otp').value;
            if (!email || !name) {
                showNotification('Please enter your name and email.', 'error');
                return;
            }
            const button = document.getElementById('sendOtpButton');
            setLoadingState(button, true, 'Sending...');
            try {
                await axios.post(`${backendUrl}/sendOTP`, { email });
                showNotification('OTP sent to your email!', 'success');
                document.getElementById('otp-details-group').style.display = 'none';
                document.getElementById('otp-verify-group').style.display = 'block';
            } catch (error) {
                showNotification(error.response?.data?.message || 'Failed to send OTP.', 'error');
            } finally {
                setLoadingState(button, false, 'Send OTP');
            }
        });

        document.getElementById('signupFormOtp').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email-otp').value;
            const name = document.getElementById('name-otp').value;
            const otp = document.getElementById('otp').value;
            const button = document.getElementById('verifyOtpButton');

            setLoadingState(button, true, 'Verifying...');

            try {
                const response = await axios.post(`${backendUrl}/verifyOTPSignup`, { email, name, otp });
                handleSuccessfulLogin(response.data.token, response.data.user);
            } catch (error) {
                const errorMessage = error.response?.data?.message || 'Invalid OTP or signup failed.';
                showNotification(errorMessage, 'error');
            } finally {
                setLoadingState(button, false, 'Verify OTP & Create Account');
            }
        });

        function handleSuccessfulLogin(token, user) {
            localStorage.setItem('authToken', token);
            localStorage.setItem('userLoggedIn', 'true');
            localStorage.setItem('userEmail', user.email);
            localStorage.setItem('userName', user.name);
            
            showNotification('Account created successfully! Welcome. ðŸŽ‰', 'success');
            setTimeout(() => { window.location.href = 'index.html'; }, 1500);
        }

        function setLoadingState(button, isLoading, loadingText) {
            if (button) {
                button.disabled = isLoading;
                const originalText = button.getAttribute('data-original-text') || button.textContent;
                if (!isLoading && !button.getAttribute('data-original-text')) {
                    button.setAttribute('data-original-text', originalText);
                }
                button.innerHTML = isLoading ? `<span class="spinner"></span> ${loadingText}` : originalText;
            }
        }

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => { notification.classList.add('show'); }, 10);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 500);
            }, 3000);
        }
    </script>
</body>
</html>